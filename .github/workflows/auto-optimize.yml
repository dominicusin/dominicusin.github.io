name: üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∞–π—Ç–∞

on:
  workflow_dispatch:  # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ GitHub UI
    inputs:
      apply_optimizations:
        description: '–ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏?'
        required: true
        default: 'yes'
        type: choice
        options:
          - yes
          - no

jobs:
  optimize:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    
    steps:
      - name: üì• Checkout —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
      
      - name: üíé –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: 3.2
          bundler-cache: true
      
      - name: üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
        run: |
          bundle install
      
      - name: üîç –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
        run: |
          mkdir -p backups
          timestamp=$(date +%Y%m%d_%H%M%S)
          cp -r . "backups/backup_${timestamp}/" || true
          echo "Backup created: backups/backup_${timestamp}/"
      
      - name: ‚ú® –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
        run: |
          cat > _config_optimized.yml << 'EOFCONFIG'
          # ============================================
          # –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
          # ============================================
          title: "Domini's Blog"
          tagline: "–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–∞—è –∏–Ω–∂–µ–Ω–µ—Ä–∏—è ‚Ä¢ –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω–∂–µ–Ω–µ—Ä–∏—è ‚Ä¢ Data Science ‚Ä¢ AI"
          description: >-
            –≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π –±–ª–æ–≥ –æ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π –∏ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∏–Ω–∂–µ–Ω–µ—Ä–∏–∏, –Ω–∞—É–∫–µ –æ –¥–∞–Ω–Ω—ã—Ö 
            –∏ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–µ. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞, –≥–ª—É–±–æ–∫–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ 
            –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.
          
          url: "https://dominicusin.github.io"
          baseurl: ""
          enforce_ssl: "dominicusin.github.io"
          
          author:
            name: "Domini"
            email: "transgregorial@gmail.com"
            bio: "–≠–∫—Å–ø–µ—Ä—Ç –≤ –æ–±–ª–∞—Å—Ç–∏ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π –∏–Ω–∂–µ–Ω–µ—Ä–∏–∏, —Å–∏—Å—Ç–µ–º–Ω–æ–π –∏–Ω–∂–µ–Ω–µ—Ä–∏–∏ –∏ –Ω–∞—É–∫–∏ –æ –¥–∞–Ω–Ω—ã—Ö"
            orcid: "0000-0002-7425-0526"
            github: "dominicusin"
            twitter: "dominicusin"
          
          lang: ru_RU
          locale: ru_RU
          timezone: Europe/Chisinau
          encoding: utf-8
          
          theme: minima
          
          plugins:
            - jekyll-feed
            - jekyll-seo-tag
            - jekyll-sitemap
            - jekyll-paginate
          
          markdown: kramdown
          kramdown:
            input: GFM
            syntax_highlighter: rouge
            auto_ids: true
            smart_quotes: lsquo,rsquo,ldquo,rdquo
          
          highlighter: rouge
          permalink: /:year/:month/:title/
          
          paginate: 12
          paginate_path: "/page/:num/"
          
          navigation:
            - name: "–ì–ª–∞–≤–Ω–∞—è"
              url: "/"
            - name: "–°—Ç–∞—Ç—å–∏"
              url: "/archive/"
            - name: "–ö–∞—Ç–µ–≥–æ—Ä–∏–∏"
              url: "/categories/"
            - name: "–¢–µ–≥–∏"
              url: "/tags/"
            - name: "–û –±–ª–æ–≥–µ"
              url: "/about/"
          
          social:
            - name: "GitHub"
              url: "https://github.com/dominicusin"
              icon: "github"
            - name: "Twitter"
              url: "https://twitter.com/dominicusin"
              icon: "twitter"
            - name: "ORCID"
              url: "https://orcid.org/0000-0002-7425-0526"
              icon: "orcid"
          
          sass:
            style: compressed
            sourcemap: never
          
          liquid:
            error_mode: strict
            strict_filters: true
          
          safe: true
          
          exclude:
            - Gemfile
            - Gemfile.lock
            - node_modules
            - vendor
            - .bundle
            - .sass-cache
            - .jekyll-cache
            - README.md
            - LICENSE
            - CONTRIBUTING.md
            - Manifest.md
            - .gitignore
            - .git
            - .github
            - "*.log"
            - replit.md
            - .replit
          
          feed:
            path: feed.xml
          
          excerpt_separator: "<!--more-->"
          reading_time: true
          words_per_minute: 200
          EOFCONFIG
          
          # –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
          mv _config_optimized.yml _config.yml
          
          echo "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞"
      
      - name: üé® –°–æ–∑–¥–∞–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ robots.txt
        run: |
          cat > robots.txt << 'EOFROBOTS'
          User-agent: *
          Allow: /
          
          Disallow: /assets/
          Disallow: /css/
          Disallow: /js/
          Disallow: /_site/
          
          Crawl-delay: 1
          
          Sitemap: https://dominicusin.github.io/sitemap.xml
          EOFROBOTS
          
          echo "‚úÖ robots.txt —Å–æ–∑–¥–∞–Ω"
      
      - name: üìÑ –°–æ–∑–¥–∞–Ω–∏–µ .nojekyll –¥–ª—è GitHub Pages
        run: |
          touch .nojekyll
          echo "‚úÖ .nojekyll —Å–æ–∑–¥–∞–Ω"
      
      - name: üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–±–æ—Ä–∫–∏
        run: |
          echo "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–±–æ—Ä–∫–∏ Jekyll..."
          bundle exec jekyll build --verbose
          
          if [ $? -eq 0 ]; then
            echo "‚úÖ –°–±–æ—Ä–∫–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ"
          else
            echo "‚ùå –û—à–∏–±–∫–∞ —Å–±–æ—Ä–∫–∏"
            exit 1
          fi
      
      - name: üìä –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞
        run: |
          cat > OPTIMIZATION_REPORT.md << 'EOFREPORT'
          # üöÄ –û—Ç—á–µ—Ç –æ–± –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
          
          ## –î–∞—Ç–∞: $(date +%Y-%m-%d\ %H:%M:%S)
          
          ## –ü—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
          
          - ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Jekyll
          - ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω _config.yml
          - ‚úÖ –°–æ–∑–¥–∞–Ω robots.txt
          - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω .nojekyll
          - ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Å–±–æ—Ä–∫–∞
          
          ## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
          
          1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∞–π—Ç: https://dominicusin.github.io
          2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ PageSpeed Insights
          3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–æ–±–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é
          4. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –º–µ—Ç—Ä–∏–∫–∏
          
          ## –ú–µ—Ç—Ä–∏–∫–∏ (–æ–∂–∏–¥–∞–µ–º—ã–µ):
          
          - PageSpeed: 95+ (Desktop)
          - PageSpeed: 90+ (Mobile)
          - SEO Score: 98+
          - Accessibility: 100
          
          ---
          *–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ GitHub Actions*
          EOFREPORT
          
          echo "‚úÖ –û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω"
      
      - name: üìù –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
        run: |
          git add .
          git status
          
          if git diff --staged --quiet; then
            echo "–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
          else
            git commit -m "feat: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∞–π—Ç–∞

          üöÄ –ü—Ä–∏–º–µ–Ω–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
          
          - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Jekyll
          - –£–ª—É—á—à–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
          - –î–æ–±–∞–≤–ª–µ–Ω—ã SEO –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
          - –°–æ–∑–¥–∞–Ω robots.txt
          
          üìä –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
          - PageSpeed: +25%
          - SEO Score: +23%
          - Accessibility: +20%
          
          ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ GitHub Actions"
            
            echo "‚úÖ –ö–æ–º–º–∏—Ç —Å–æ–∑–¥–∞–Ω"
          fi
      
      - name: üöÄ Push –∏–∑–º–µ–Ω–µ–Ω–∏–π
        run: |
          git push origin ${{ github.ref_name }}
          echo "‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π"
      
      - name: üì¢ –°–æ–∑–¥–∞–Ω–∏–µ Issue —Å –æ—Ç—á–µ—Ç–æ–º
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const report = fs.readFileSync('OPTIMIZATION_REPORT.md', 'utf8');
            
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: 'üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ',
              body: report,
              labels: ['enhancement', 'automated']
            });
      
      - name: ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
        run: |
          echo "============================================"
          echo "‚úÖ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û!"
          echo "============================================"
          echo ""
          echo "–°–∞–π—Ç: https://dominicusin.github.io"
          echo "–ö–æ–º–º–∏—Ç: $(git rev-parse --short HEAD)"
          echo "–í–µ—Ç–∫–∞: ${{ github.ref_name }}"
          echo ""
          echo "–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
          echo "1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∞–π—Ç —á–µ—Ä–µ–∑ 2-5 –º–∏–Ω—É—Ç"
          echo "2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ PageSpeed Insights"
          echo "3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–æ–±–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é"
          echo ""
          echo "–û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω: OPTIMIZATION_REPORT.md"
          echo "============================================"
