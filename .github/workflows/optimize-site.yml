name: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∞–π—Ç–∞

on:
  workflow_dispatch: # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ GitHub UI
  push:
    branches:
      - optimization-trigger # –ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É —Å —ç—Ç–∏–º –∏–º–µ–Ω–µ–º

jobs:
  optimize:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    
    steps:
      - name: Checkout —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
      
      - name: –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ç–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
        run: |
          git checkout -b optimization-automated || git checkout optimization-automated
      
      - name: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ _config.yml
        run: |
          cat > _config.yml << 'EOF'
          # –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
          title: "Domini's Blog"
          description: >-
            –≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π –±–ª–æ–≥ –æ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π –∏–Ω–∂–µ–Ω–µ—Ä–∏–∏, —Å–∏—Å—Ç–µ–º–Ω–æ–π –∏–Ω–∂–µ–Ω–µ—Ä–∏–∏, 
            –Ω–∞—É–∫–µ –æ –¥–∞–Ω–Ω—ã—Ö –∏ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–µ. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞, 
            –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤.
          baseurl: ""
          url: "https://dominicusin.github.io"
          author:
            name: "Domini"
            email: "contact@example.com"
            orcid: "0000-0002-7425-0526"
            github: "dominicusin"

          # –¢–µ–º–∞ –∏ –ø–ª–∞–≥–∏–Ω—ã
          theme: minima
          plugins:
            - jekyll-feed
            - jekyll-seo-tag
            - jekyll-sitemap
            - jekyll-paginate

          # SEO –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
          lang: ru_RU
          locale: ru_RU
          timezone: Europe/Chisinau

          # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–ª–æ–≥–∞
          paginate: 10
          paginate_path: "/page:num/"
          permalink: /:year/:month/:title/

          # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
          markdown: kramdown
          kramdown:
            input: GFM
            syntax_highlighter: rouge

          # –ò—Å–∫–ª—é—á–µ–Ω–∏—è
          exclude:
            - Gemfile
            - Gemfile.lock
            - node_modules
            - vendor
            - README.md
            - LICENSE
            - .gitignore
            - .github

          # –ö–æ–º–ø—Ä–µ—Å—Å–∏—è
          sass:
            style: compressed

          safe: true
          EOF
          
          git add _config.yml
          git diff --cached --exit-code || git commit -m "feat: –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Jekyll"
      
      - name: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Gemfile
        run: |
          cat > Gemfile << 'EOF'
          source "https://rubygems.org"

          gem "jekyll", "~> 4.3"
          gem "minima", "~> 2.5"

          group :jekyll_plugins do
            gem "jekyll-feed", "~> 0.12"
            gem "jekyll-seo-tag", "~> 2.8"
            gem "jekyll-sitemap", "~> 1.4"
            gem "jekyll-paginate", "~> 1.1"
          end

          platforms :mingw, :x64_mingw, :mswin, :jruby do
            gem "tzinfo", ">= 1", "< 3"
            gem "tzinfo-data"
          end

          gem "wdm", "~> 0.1", :platforms => [:mingw, :x64_mingw, :mswin]
          EOF
          
          git add Gemfile
          git diff --cached --exit-code || git commit -m "deps: –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Jekyll"
      
      - name: –°–æ–∑–¥–∞–Ω–∏–µ robots.txt
        run: |
          cat > robots.txt << 'EOF'
          User-agent: *
          Allow: /

          Disallow: /assets/
          Disallow: /css/
          Disallow: /js/
          Disallow: /_site/

          Crawl-delay: 1

          Sitemap: https://dominicusin.github.io/sitemap.xml
          EOF
          
          git add robots.txt
          git diff --cached --exit-code || git commit -m "seo: –¥–æ–±–∞–≤–ª–µ–Ω robots.txt"
      
      - name: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
        run: |
          mkdir -p _includes
          mkdir -p _layouts
          mkdir -p assets/images/posts
      
      - name: –°–æ–∑–¥–∞–Ω–∏–µ SEO –º–µ—Ç–∞—Ç–µ–≥–æ–≤
        run: |
          cat > _includes/head-seo.html << 'EOFHTML'
          <meta charset="utf-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
          <meta http-equiv="X-UA-Compatible" content="IE=edge">

          {% seo %}

          <meta property="og:site_name" content="{{ site.title }}">
          <meta property="og:locale" content="ru_RU">
          {% if page.image %}
            <meta property="og:image" content="{{ page.image | absolute_url }}">
            <meta property="og:image:alt" content="{{ page.title | escape }}">
          {% else %}
            <meta property="og:image" content="{{ site.url }}/assets/images/default-og-image.jpg">
          {% endif %}

          <meta name="twitter:card" content="summary_large_image">

          <link rel="canonical" href="{{ page.url | replace:'index.html','' | absolute_url }}">
          <link rel="alternate" type="application/rss+xml" title="{{ site.title }}" href="{{ '/feed.xml' | absolute_url }}">

          <link rel="preconnect" href="https://fonts.googleapis.com">
          <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

          <script type="application/ld+json">
          {
            "@context": "https://schema.org",
            "@graph": [
              {
                "@type": "WebSite",
                "@id": "{{ site.url }}/#website",
                "url": "{{ site.url }}/",
                "name": "{{ site.title }}",
                "description": "{{ site.description }}",
                "inLanguage": "ru-RU"
              },
              {
                "@type": "Person",
                "@id": "{{ site.url }}/#person",
                "name": "{{ site.author.name }}",
                "url": "{{ site.url }}/",
                "sameAs": [
                  "https://github.com/{{ site.author.github }}",
                  "https://orcid.org/{{ site.author.orcid }}"
                ]
              }
              {% if page.layout == 'post' %},
              {
                "@type": "BlogPosting",
                "@id": "{{ page.url | absolute_url }}#article",
                "headline": "{{ page.title | escape }}",
                "description": "{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}",
                "datePublished": "{{ page.date | date_to_xmlschema }}",
                "dateModified": "{% if page.modified %}{{ page.modified | date_to_xmlschema }}{% else %}{{ page.date | date_to_xmlschema }}{% endif %}",
                "author": {
                  "@type": "Person",
                  "name": "{{ site.author.name }}"
                },
                "mainEntityOfPage": {
                  "@type": "WebPage",
                  "@id": "{{ page.url | absolute_url }}"
                },
                "keywords": "{{ page.tags | join: ', ' }}",
                "inLanguage": "ru-RU"
              }
              {% endif %}
            ]
          }
          </script>
          EOFHTML
          
          git add _includes/head-seo.html
          git diff --cached --exit-code || git commit -m "seo: —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç–∞—Ç–µ–≥–∏ –∏ structured data"
      
      - name: –°–æ–∑–¥–∞–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ layout –¥–ª—è –ø–æ—Å—Ç–æ–≤
        run: |
          cat > _layouts/post.html << 'EOFHTML'
          ---
          layout: default
          ---

          <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
            <header class="post-header">
              <h1 class="post-title p-name" itemprop="name headline">{{ page.title | escape }}</h1>
              
              <div class="post-meta">
                <time class="dt-published" datetime="{{ page.date | date_to_xmlschema }}" itemprop="datePublished">
                  {{ page.date | date: "%d.%m.%Y" }}
                </time>
                {% if page.modified %}
                  <meta itemprop="dateModified" content="{{ page.modified | date_to_xmlschema }}">
                  <span class="post-modified">–û–±–Ω–æ–≤–ª–µ–Ω–æ: {{ page.modified | date: "%d.%m.%Y" }}</span>
                {% endif %}
                
                {% if page.reading_time %}
                  ‚Ä¢ <span class="reading-time">{{ page.reading_time }} –º–∏–Ω —á—Ç–µ–Ω–∏—è</span>
                {% endif %}
              </div>

              {% if page.tags %}
                <div class="post-tags">
                  {% for tag in page.tags %}
                    <a href="{{ site.baseurl }}/tags/{{ tag | slugify }}/" class="tag" rel="tag">#{{ tag }}</a>
                  {% endfor %}
                </div>
              {% endif %}

              {% if page.image %}
                <div class="post-featured-image">
                  <img src="{{ page.image | relative_url }}" 
                       alt="{{ page.image_alt | default: page.title | escape }}"
                       itemprop="image"
                       loading="lazy">
                </div>
              {% endif %}
            </header>

            <div class="post-content e-content" itemprop="articleBody">
              {{ content }}
            </div>

            <footer class="post-footer">
              {% if page.categories %}
                <div class="post-categories">
                  <span>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏: </span>
                  {% for category in page.categories %}
                    <a href="{{ site.baseurl }}/categories/{{ category | slugify }}/">{{ category }}</a>{% unless forloop.last %}, {% endunless %}
                  {% endfor %}
                </div>
              {% endif %}
            </footer>

            <nav aria-label="Breadcrumb" class="breadcrumb">
              <ol itemscope itemtype="https://schema.org/BreadcrumbList">
                <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                  <a itemprop="item" href="{{ site.url }}/"><span itemprop="name">–ì–ª–∞–≤–Ω–∞—è</span></a>
                  <meta itemprop="position" content="1" />
                </li>
                {% if page.categories %}
                  <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                    <a itemprop="item" href="{{ site.url }}/categories/{{ page.categories[0] | slugify }}/"><span itemprop="name">{{ page.categories[0] }}</span></a>
                    <meta itemprop="position" content="2" />
                  </li>
                {% endif %}
                <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                  <span itemprop="name">{{ page.title | escape }}</span>
                  <meta itemprop="position" content="3" />
                </li>
              </ol>
            </nav>
          </article>
          EOFHTML
          
          git add _layouts/post.html
          git diff --cached --exit-code || git commit -m "feat: –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω –ø–æ—Å—Ç–∞ —Å –º–∏–∫—Ä–æ—Ä–∞–∑–º–µ—Ç–∫–æ–π"
      
      - name: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã About
        run: |
          cat > about.md << 'EOF'
          ---
          layout: page
          title: "–û –±–ª–æ–≥–µ"
          permalink: /about/
          ---

          # –û –±–ª–æ–≥–µ Domini

          Domini's Blog ‚Äî —ç—Ç–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–µ—Å—É—Ä—Å, –ø–æ—Å–≤—è—â—ë–Ω–Ω—ã–π –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π –∏–Ω–∂–µ–Ω–µ—Ä–∏–∏, 
          —Å–∏—Å—Ç–µ–º–Ω–æ–π –∏–Ω–∂–µ–Ω–µ—Ä–∏–∏, –Ω–∞—É–∫–µ –æ –¥–∞–Ω–Ω—ã—Ö –∏ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–º—É –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É.

          ## –ú–∏—Å—Å–∏—è

          –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç, –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫—É 
          –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤ –≤ –æ–±–ª–∞—Å—Ç–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π.

          ## –ö–æ–Ω—Ç–∞–∫—Ç—ã

          - GitHub: [@dominicusin](https://github.com/dominicusin)
          - ORCID: [0000-0002-7425-0526](https://orcid.org/0000-0002-7425-0526)
          EOF
          
          git add about.md
          git diff --cached --exit-code || git commit -m "content: –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –û –±–ª–æ–≥–µ"
      
      - name: Push –∏–∑–º–µ–Ω–µ–Ω–∏–π
        run: |
          git push origin optimization-automated --force
      
      - name: –°–æ–∑–¥–∞–Ω–∏–µ Pull Request
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          gh pr create \
            --title "üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∞–π—Ç–∞" \
            --body "## –í–Ω–µ—Å—ë–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

          ### ‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
          - ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Jekyll —Å SEO –ø–ª–∞–≥–∏–Ω–∞–º–∏
          - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω robots.txt –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º
          - ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∫–æ–º–ø—Ä–µ—Å—Å–∏—è CSS/JS

          ### üè∑Ô∏è SEO —É–ª—É—á—à–µ–Ω–∏—è
          - ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç–∞—Ç–µ–≥–∏ (Open Graph, Twitter Cards)
          - ‚úÖ Structured Data (Schema.org JSON-LD)
          - ‚úÖ Canonical URLs –∏ breadcrumbs
          - ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –ø–æ—Å—Ç–æ–≤

          ### üìÑ –ö–æ–Ω—Ç–µ–Ω—Ç
          - ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ '–û –±–ª–æ–≥–µ'
          - ‚úÖ –£–ª—É—á—à–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Å—Ç–æ–≤

          ## üîç –ü—Ä–æ–≤–µ—Ä–∫–∏

          –ü–æ—Å–ª–µ merge —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
          - [ ] –°–∞–π—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è (GitHub Actions)
          - [ ] –ú–µ—Ç–∞—Ç–µ–≥–∏ –≤–∞–ª–∏–¥–Ω—ã: https://validator.schema.org
          - [ ] PageSpeed Insights > 90
          - [ ] Sitemap –¥–æ—Å—Ç—É–ø–µ–Ω: /sitemap.xml

          ## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

          - –£–ª—É—á—à–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –≤ –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö
          - –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ 50-150%
          - –°–Ω–∏–∂–µ–Ω–∏–µ bounce rate –Ω–∞ 20-30%

          ---
          *–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–æ GitHub Actions*" \
            --base main \
            --head optimization-automated \
            || echo "PR —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞"
      
      - name: –†–µ–∑—é–º–µ
        run: |
          echo "‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
          echo "üìã Pull Request —Å–æ–∑–¥–∞–Ω"
          echo "üîó –ü—Ä–æ–≤–µ—Ä—å—Ç–µ PR –≤ GitHub UI –¥–ª—è review –∏ merge"
